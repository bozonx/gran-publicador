
###### Basic app settings
NODE_ENV=production
LISTEN_HOST=0.0.0.0
LISTEN_PORT=8080
# Render.com provides PORT automatically. If set, it takes precedence over LISTEN_PORT.
# PORT=8080
# SERVER_BASE_PATH=
LOG_LEVEL=warn
# Force application timezone (affects pretty logs)
TZ=UTC

# Prisma migrations on container start.
# IMPORTANT: for autoscaling environments it is recommended to keep this disabled and run migrations as a separate one-off job.
RUN_MIGRATIONS_ON_START=false

# Timeout for graceful shutdown in seconds (default: 30)
SHUTDOWN_TIMEOUT_SECONDS=30

# Global retry settings for outbound HTTP requests
HTTP_RETRY_MAX_ATTEMPTS=3
HTTP_RETRY_INITIAL_DELAY_MS=500
HTTP_RETRY_MAX_DELAY_MS=5000

###### Scheduler Configuration. It publish posts and process scheduled tasks
# "Past window" in minutes for processing scheduled tasks (default: 10)
SCHEDULER_WINDOW_MINUTES=10

###### Main connections
# Base URL of the frontend. Used by backend to generate public links for media files.
FRONTEND_URL="https://your-domain.com"

### Postgres Configuration
DATABASE_URL="postgresql://gran:gran_password@postgres:5432/gran_db?schema=public"

### Redis Configuration
# Redis is required in all non-test environments.
# Redis connection URL (works with both regular Redis and Upstash)
REDIS_URL=redis://redis:6379/0
# Redis key prefix (optional, default: empty). Use this to separate keys of different apps in the same Redis instance.
# Applies to both regular Redis and Upstash Redis configurations.
REDIS_KEY_PREFIX=gran-p:
# Default cache TTL in milliseconds (default: 3600000)
REDIS_TTL_MS=3600000

###### Authentication
# Shared secret for system API (e.g. for n8n triggers). Change this to a secure random string.
SYSTEM_API_SECRET="generate-a-secure-system-secret-here"
# Whether to restrict system API to local network IPs (RFC 1918) and localhost (default: true)
SYSTEM_API_IP_RESTRICTION_ENABLED=true
# MANDATORY: Change this to a long random string
JWT_SECRET="generate-a-very-long-and-secure-secret-here"
# OPTIONAL: Telegram ID of the super administrator
TELEGRAM_ADMIN_ID=""
# MANDATORY: Token from @BotFather. It is used for telegram bot and for authorization of users
TELEGRAM_BOT_TOKEN=""

###### Telegram Bot Configuration
# Whether to enable the Telegram bot for repost collection
TELEGRAM_BOT_ENABLED=false
# OPTIONAL: Base URL for the Telegram Mini App. Defaults to FRONTEND_URL if not set.
TELEGRAM_MINI_APP_URL=""

###################################################
########## MICROSERVICES CONFIGURATION ############
###################################################

###### Social Posting Configuration
# Microservice URL (e.g., http://social-posting:8080/api/v1)
SOCIAL_POSTING_SERVICE_URL="http://social-media-posting-microservice:8080/api/v1"
# Optional API token for Bearer authorization
SOCIAL_POSTING_SERVICE_API_TOKEN=
# Single request timeout in seconds
SOCIAL_POSTING_REQUEST_TIMEOUT_SECS=30
# How long to keep idempotency keys in cache to prevent duplicate posts (minutes)
SOCIAL_POSTING_IDEMPOTENCY_TTL_MINUTES=10

###### Media Storage Configuration
# Media Storage microservice URL
MEDIA_STORAGE_SERVICE_URL="http://media-storage-microservice:8080/api/v1"
# Optional API token for Bearer authorization
MEDIA_STORAGE_API_TOKEN=
# Single request timeout in seconds (default: 60)
MEDIA_REQUEST_TIMEOUT_SECS=60
# Maximum file size in megabytes (default: 100)
MEDIA_STORAGE_MAX_FILE_SIZE_MB=100
# Thumbnail settings (optional)
# Thumbnail quality (default: 80)
THUMBNAIL_QUALITY=80
# Image optimization defaults for uploads to Media Storage
# Global optimization switch (default: true)
MEDIA_IMAGE_OPTIMIZATION_ENABLED=true
# Forced output format for optimized images (webp|avif, default: webp)
MEDIA_IMAGE_OPTIMIZATION_FORMAT=webp
# Forced max dimension in pixels (default: 3840)
MEDIA_IMAGE_OPTIMIZATION_MAX_DIMENSION=3840
# Forced encoder effort (0-6, default: 4)
MEDIA_IMAGE_OPTIMIZATION_EFFORT=4
# Forced quality (1-100, default: 80)
MEDIA_IMAGE_OPTIMIZATION_QUALITY=80
# Forced chroma subsampling (4:2:0|4:4:4, default: 4:2:0)
MEDIA_IMAGE_OPTIMIZATION_CHROMA_SUBSAMPLING=4:2:0

###### Free LLM Router Configuration
# Free LLM Router microservice URL
FREE_LLM_ROUTER_URL="http://free-llm-router-microservice:8080/api/v1"
# Optional API token for Bearer authorization
FREE_LLM_ROUTER_API_TOKEN=
# Default tags for model selection (comma-separated, e.g., "fast,best-for-ru")
FREE_LLM_ROUTER_TAGS="fast"
# Default model type: "fast" or "reasoning" (optional)
# FREE_LLM_ROUTER_TYPE="fast"
# Maximum model switches per request (optional)
# FREE_LLM_ROUTER_MAX_MODEL_SWITCHES=3
# Maximum retries on the same model (optional)
# FREE_LLM_ROUTER_MAX_SAME_MODEL_RETRIES=2
# Retry delay in milliseconds (optional)
# FREE_LLM_ROUTER_RETRY_DELAY=3000
# Single request timeout in seconds (optional)
LLM_REQUEST_TIMEOUT_SECS=120
# Fallback provider (optional, e.g., "deepseek")
# FREE_LLM_ROUTER_FALLBACK_PROVIDER=""
# Fallback model (optional, e.g., "deepseek-chat")
# FREE_LLM_ROUTER_FALLBACK_MODEL=""
# Minimum context size (optional)
# FREE_LLM_ROUTER_MIN_CONTEXT_SIZE=32000
# Minimum max output tokens (optional)
# FREE_LLM_ROUTER_MIN_MAX_OUTPUT_TOKENS=4000
# Default temperature (optional)
# FREE_LLM_ROUTER_TEMPERATURE=0.7
# Default max tokens (optional)
# FREE_LLM_ROUTER_MAX_TOKENS=4000

###### Translation Configuration
# Translation Gateway microservice URL
TRANSLATE_SERVICE_URL="http://translate-gateway-microservice:8081/api/v1"
# Optional API token for Bearer authorization
TRANSLATE_SERVICE_API_TOKEN=
# Single request timeout in seconds
TRANSLATE_REQUEST_TIMEOUT_SECS=30
# Default translation provider (anylang, google, deepl, etc.)
TRANSLATE_DEFAULT_PROVIDER="anylang"
# Default model for the provider (optional)
# TRANSLATE_DEFAULT_MODEL="auto"
# Maximum allowed input text length (default: 1000000, range: 100-10000000)
TRANSLATE_MAX_TEXT_LENGTH=1000000

###### Speech-To-Text Configuration
# STT Gateway microservice URL
STT_SERVICE_URL="http://stt-gateway-microservice:8080/api/v1"
# Optional API token for Bearer authorization
STT_SERVICE_API_TOKEN=
# Single request timeout in seconds (default: 600)
STT_REQUEST_TIMEOUT_SECS=600
# Maximum audio file size in bytes (default: 50MB)
STT_MAX_FILE_SIZE=52428800
# Default provider to use for all STT requests (optional)
STT_DEFAULT_PROVIDER="assemblyai"
# Default models to use (comma-separated, optional)
STT_DEFAULT_MODELS="universal-2"
# Whether to always pass user's language to STT (default: true)
STT_SEND_USER_LANGUAGE=true
# Default punctuation restoration setting (optional)
STT_RESTORE_PUNCTUATION=true
# Default text formatting setting (optional)
STT_FORMAT_TEXT=true

###### News Service Configuration
# News Service microservice URL
NEWS_SERVICE_URL="http://news-microservice:8088"
# Optional API token for Bearer authorization
NEWS_SERVICE_API_TOKEN=
# Single request timeout in seconds
NEWS_REQUEST_TIMEOUT_SECS=30
# News notifications scheduler is triggered manually via POST /system/schedulers/news/run
# (no NEWS_NOTIFICATION_INTERVAL_MINUTES variable)
# Maximum lookback window in hours for news scheduler (default: 3)
NEWS_SCHEDULER_LOOKBACK_HOURS=3
# Maximum number of news items to fetch in a single scheduler run (default: 100)
NEWS_SCHEDULER_FETCH_LIMIT=100
# Optional fingerprint for news refresh (JSON string)
# NEWS_REFRESH_FINGERPRINT='{"userAgent": "..."}'
# Optional mode for news refresh/scraping (extractor or playwright)
NEWS_REFRESH_MODE=playwright

###### Unsplash Configuration
# Unsplash API access key for the UNSPLASH collection type
# Get your key at https://unsplash.com/developers
# UNSPLASH_ACCESS_KEY=your_access_key_here
# Single request timeout in seconds
UNSPLASH_REQUEST_TIMEOUT_SECS=30
