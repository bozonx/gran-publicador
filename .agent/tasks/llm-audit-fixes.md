# План исправления проблем LLM функциональности

## Цель
Исправить все выявленные проблемы в функциональности LLM и управления шаблонами промптов, кроме rate limiting, e2e тестов, тестов фронтенда и кэширования.

## Задачи

### 1. Безопасность и права доступа ✅
- [ ] Добавить проверку прав доступа в `llm-prompt-templates.controller.ts`
- [ ] Создать guard для проверки владения шаблонами
- [ ] Исправить метод `reorder` с валидацией владения
- [ ] Добавить проверку членства в проекте для проектных шаблонов

### 2. Перенос формирования контекста на бэкенд ✅
- [ ] Расширить `GenerateContentDto` для приема контекста и source texts
- [ ] Добавить форматирование контекста на бэкенде
- [ ] Добавить truncation с учетом лимита токенов
- [ ] Обновить фронтенд для отправки сырых данных

### 3. Unit тесты бэкенда ✅
- [ ] Написать тесты для `llm.service.ts`
- [ ] Написать тесты для `llm.controller.ts`
- [ ] Написать тесты для `llm-prompt-templates.service.ts`
- [ ] Написать тесты для `llm-prompt-templates.controller.ts`

### 4. Исправление багов ✅
- [ ] Автоматический расчет `order` при создании шаблона
- [ ] Рефакторинг построения requestBody в `llm.service.ts`
- [ ] Улучшение обработки ошибок в `useLlm.ts`

### 5. UX улучшения ✅
- [ ] Добавить счетчик токенов в UI
- [ ] Добавить поиск по шаблонам
- [ ] Улучшить пустое состояние списка шаблонов
- [ ] Исправить группировку в селекторе шаблонов
- [ ] Получать лимиты из конфигурации

### 6. Документация ✅
- [ ] Обновить README с информацией о LLM функциональности
- [ ] Добавить JSDoc комментарии
- [ ] Добавить валидацию шаблонов (длина, содержимое)

## Приоритет выполнения
1. Безопасность (критично)
2. Перенос контекста на бэкенд (критично)
3. Unit тесты (важно)
4. Исправление багов (важно)
5. UX улучшения (желательно)
6. Документация (желательно)
