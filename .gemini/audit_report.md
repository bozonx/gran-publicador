# –ê—É–¥–∏—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ Edge Cases

**–î–∞—Ç–∞**: 2026-01-14  
**–ü—Ä–æ–µ–∫—Ç**: Gran Publicador  
**–¶–µ–ª—å**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –≤–æ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª—è—Ö

---

## üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞

**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç—Å—è —É–ª—É—á—à–µ–Ω–∏—è  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è-–í—ã—Å–æ–∫–∞—è  
**–ü–æ–∫—Ä—ã—Ç–∏–µ**: ~70% edge cases –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **NotificationsService** - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞ null/undefined

**–§–∞–π–ª**: `src/modules/notifications/notifications.service.ts`

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå –ú–µ—Ç–æ–¥ `markAsRead` (—Å—Ç—Ä–æ–∫–∞ 83-95): –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ `notification` –Ω–µ null –ø–µ—Ä–µ–¥ –¥–æ—Å—Ç—É–ø–æ–º –∫ `notification.userId`
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ `create`
- ‚ùå –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —á–µ—Ä–µ–∑ WebSocket

**–ö–æ–¥ —Å –ø—Ä–æ–±–ª–µ–º–æ–π**:
```typescript
async markAsRead(id: string, userId: string) {
  const notification = await (this.prisma as any).notification.findUnique({
    where: { id },
  });

  if (notification?.userId !== userId) {  // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç optional chaining
    throw new NotFoundException('Notification not found');
  }
  // –ù–æ –µ—Å–ª–∏ notification === null, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ—Ç –∫–∞–∫ undefined !== userId
}
```

**–†–∏—Å–∫**: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

---

### 2. **ProjectsService** - –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –º–∞—Å—Å–∏–≤–∞–º–∏

**–§–∞–π–ª**: `src/modules/projects/projects.service.ts`

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå –°—Ç—Ä–æ–∫–∞ 222: `project.members[0]` - –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
- ‚ùå –°—Ç—Ä–æ–∫–∞ 305: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
- ‚ùå –°—Ç—Ä–æ–∫–∞ 548-550: –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null –¥–ª—è `inviter`

**–ö–æ–¥ —Å –ø—Ä–æ–±–ª–µ–º–æ–π**:
```typescript
const userMember = project.members[0];  // ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å undefined
// ...
role: project.ownerId === userId ? 'owner' : userMember?.role?.toLowerCase(),
```

**–†–∏—Å–∫**: Runtime –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —á–ª–µ–Ω–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

---

### 3. **PublicationsService** - –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

**–§–∞–π–ª**: `src/modules/publications/publications.service.ts`

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ 120: –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null –¥–ª—è `fullPub.content`
- ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ 311: –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null –¥–ª—è `publication.content`
- ‚ùå –°—Ç—Ä–æ–∫–∞ 461-468: –ø–∞—Ä—Å–∏–Ω–≥ media –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null –¥–ª—è `pm.media`

**–ö–æ–¥ —Å –ø—Ä–æ–±–ª–µ–º–æ–π**:
```typescript
const parsedMedia = publication.media?.map(pm => ({
  ...pm,
  media: pm.media  // ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å null
    ? {
        ...pm.media,
        meta: this.parseMetaJson(pm.media.meta),
      }
    : pm.media,
}));
```

**–†–∏—Å–∫**: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –º–µ–¥–∏–∞

---

### 4. **SocialPostingService** - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏

**–§–∞–π–ª**: `src/modules/social-posting/social-posting.service.ts`

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ 581-615: `sendRequest` –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ç–∏–ø—ã —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- ‚ùå –°—Ç—Ä–æ–∫–∞ 73: –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ `response.data`
- ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ 502-524: –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å `response.data.publishedAt`

**–ö–æ–¥ —Å –ø—Ä–æ–±–ª–µ–º–æ–π**:
```typescript
if (response.success && 'valid' in (response.data || {})) {
  const data = response.data as any;  // ‚ùå –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤
  if (data.valid) {
    // ...
  }
}
```

**–†–∏—Å–∫**: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞

---

### 5. **MediaService** - –ü—Ä–æ–±–ª–µ–º—ã —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é —Ñ–∞–π–ª–æ–≤

**–§–∞–π–ª**: `src/modules/media/media.service.ts`

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚úÖ –•–æ—Ä–æ—à–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π (—Å—Ç—Ä–æ–∫–∏ 80-105, 459-464)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
- ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ 710: –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `contentLength`
- ‚ùå –°—Ç—Ä–æ–∫–∞ 532-542: race condition –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ä–∞–∑–º–µ—Ä–∞ –≤ —Å—Ç—Ä–∏–º–µ

**–ö–æ–¥ —Å –ø—Ä–æ–±–ª–µ–º–æ–π**:
```typescript
stream.on('data', chunk => {
  size += chunk.length;
  if (size > this.maxFileSize) {
    fileStream.destroy();
    reject(new BadRequestException(`File exceeds size limit`));
  }
});
```

**–†–∏—Å–∫**: –§–∞–π–ª –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–∏—Å–∞–Ω –ø–µ—Ä–µ–¥ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ–º

---

### 6. **PublicationSchedulerService** - –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–π–º–µ—Ä–∞–º–∏

**–§–∞–π–ª**: `src/modules/social-posting/publication-scheduler.service.ts`

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚úÖ –•–æ—Ä–æ—à–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–∞–π–º–µ—Ä–æ–≤ –≤ `onModuleDestroy`
- ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ 55: `doesExist` –º–æ–∂–µ—Ç –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
- ‚ùå –°—Ç—Ä–æ–∫–∞ 120: –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null –¥–ª—è `fullPub.content`

**–ö–æ–¥ —Å –ø—Ä–æ–±–ª–µ–º–æ–π**:
```typescript
message: `Publication "${fullPub.title || fullPub.content?.substring(0, 30)}..." has expired`,
// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç optional chaining, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
```

**–†–∏—Å–∫**: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

---

## üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 7. **ChannelsService** - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ `channelIdentifier`
- ‚ö†Ô∏è –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ credentials –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
- ‚úÖ –•–æ—Ä–æ—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ archived –∫–∞–Ω–∞–ª–æ–≤

---

### 8. **AuthService** - –ü—Ä–æ–±–ª–µ–º—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –≤—Ä–µ–º–µ–Ω–∏

**–§–∞–π–ª**: `src/modules/auth/auth.service.ts`

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ 160, 196: –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–π –ª–∏–º–∏—Ç –≤ 24 —á–∞—Å–∞
- ‚ùå –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π `auth_date`
- ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ 69-73: try-catch —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞, –Ω–æ –Ω–µ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–ö–æ–¥ —Å –ø—Ä–æ–±–ª–µ–º–æ–π**:
```typescript
if (now - data.auth_date > 86400) {  // ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  this.logger.warn('Telegram widget data expired');
  return false;
}
```

**–†–∏—Å–∫**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±—É–¥—É—â–µ–≥–æ

---

### 9. **LlmService** - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ retry –ª–æ–≥–∏–∫–∏

**–§–∞–π–ª**: `src/modules/llm/llm.service.ts`

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå –ù–µ—Ç retry –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö
- ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ 128: –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `choices[0]`
- ‚ùå –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ –æ—Ç LLM Router

**–ö–æ–¥ —Å –ø—Ä–æ–±–ª–µ–º–æ–π**:
```typescript
extractContent(response: LlmResponse): string {
  return response.choices[0]?.message?.content || '';  // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç optional chaining
}
```

**–†–∏—Å–∫**: –ü—É—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö LLM

---

### 10. **TranslateService** - –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å LlmService

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå –ù–µ—Ç retry –ª–æ–≥–∏–∫–∏
- ‚ö†Ô∏è –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª–∏–Ω—ã —Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- ‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ undefined –∑–Ω–∞—á–µ–Ω–∏–π –º–æ–∂–µ—Ç —Å–∫—Ä—ã—Ç—å –æ—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## üü¢ –•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **MediaService**:
   - –û—Ç–ª–∏—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π —Ñ–∞–π–ª–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ path traversal
   - –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö MIME —Ç–∏–ø–æ–≤

2. **ProjectsService**:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

3. **PublicationsService**:
   - –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —è–∑—ã–∫–∞ –≤ –≥—Ä—É–ø–ø–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
   - –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤

4. **SocialPostingService**:
   - –ó–∞—â–∏—Ç–∞ –æ—Ç race conditions —á–µ—Ä–µ–∑ `updateMany` —Å —É—Å–ª–æ–≤–∏—è–º–∏
   - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å—Ç–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞
   - –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è JSON –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

5. **PublicationSchedulerService**:
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥ `isProcessing`
   - –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

### üî¥ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):

1. **NotificationsService.markAsRead** - –¥–æ–±–∞–≤–∏—Ç—å —è–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ null
2. **ProjectsService** - –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—É—Å—Ç—ã–µ –º–∞—Å—Å–∏–≤—ã members
3. **MediaService** - –∏—Å–ø—Ä–∞–≤–∏—Ç—å race condition –≤ —Å—Ç—Ä–∏–º–µ
4. **AuthService** - –≤–∞–ª–∏–¥–∞—Ü–∏—è auth_date –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å

### üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è):

5. **SocialPostingService** - —É–ª—É—á—à–∏—Ç—å —Ç–∏–ø–∏–∑–∞—Ü–∏—é –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞
6. **PublicationsService** - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null –¥–ª—è content
7. **LlmService/TranslateService** - –¥–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É

### üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—É–ª—É—á—à–µ–Ω–∏—è):

8. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ unit —Ç–µ—Å—Ç–æ–≤ –¥–ª—è edge cases
9. –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
10. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üõ†Ô∏è –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: NotificationsService.markAsRead

```typescript
async markAsRead(id: string, userId: string) {
  const notification = await (this.prisma as any).notification.findUnique({
    where: { id },
  });

  // ‚úÖ –Ø–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
  if (!notification) {
    throw new NotFoundException('Notification not found');
  }

  // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
  if (notification.userId !== userId) {
    throw new NotFoundException('Notification not found');
  }

  return (this.prisma as any).notification.update({
    where: { id },
    data: { readAt: new Date() },
  });
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: ProjectsService - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –º–∞—Å—Å–∏–≤–∞–º–∏

```typescript
const userMember = project.members.length > 0 ? project.members[0] : null;
// ...
role: project.ownerId === userId ? 'owner' : (userMember?.role?.toLowerCase() || 'viewer'),
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: AuthService - –≤–∞–ª–∏–¥–∞—Ü–∏—è auth_date

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å auth_date
const authDateNum = Number(authDate);
if (isNaN(authDateNum) || authDateNum < 0 || authDateNum > now) {
  this.logger.warn('Invalid auth_date value');
  return false;
}

if (now - authDateNum > 86400) {
  this.logger.warn('Telegram init data expired');
  return false;
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 4: MediaService - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–∏–º–∞–º–∏

```typescript
let size = 0;
let sizeExceeded = false;

await new Promise<void>((resolve, reject) => {
  stream.on('data', chunk => {
    if (sizeExceeded) return;
    
    size += chunk.length;
    if (size > this.maxFileSize) {
      sizeExceeded = true;
      fileStream.destroy();
      stream.destroy();
      // –£–¥–∞–ª–∏—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
      unlink(filePath).catch(() => {});
      reject(new BadRequestException(`File exceeds size limit`));
    }
  });
  
  stream.pipe(fileStream);
  fileStream.on('finish', () => {
    if (!sizeExceeded) resolve();
  });
  fileStream.on('error', reject);
});
```

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| –û–±—Ä–∞–±–æ—Ç–∫–∞ null/undefined | 7/10 | –•–æ—Ä–æ—à–æ, –Ω–æ –µ—Å—Ç—å –ø—Ä–æ–ø—É—Å–∫–∏ |
| –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | 8/10 | –û—Ç–ª–∏—á–Ω–æ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫ | 6/10 | –ù—É–∂–Ω—ã retry –∏ –ª—É—á—à–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤ | 9/10 | –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ |
| –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î | 8/10 | –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≥–¥–µ –Ω—É–∂–Ω–æ |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ | 7/10 | –•–æ—Ä–æ—à–æ, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å |
| Race conditions | 8/10 | –•–æ—Ä–æ—à–∞—è –∑–∞—â–∏—Ç–∞ |
| –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ | 9/10 | –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞**: 7.75/10

---

## üéØ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

1. **–ù–µ–¥–µ–ª—è 1**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–ø—É–Ω–∫—Ç—ã 1-4)
2. **–ù–µ–¥–µ–ª—è 2**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–ø—É–Ω–∫—Ç—ã 5-7)
3. **–ù–µ–¥–µ–ª—è 3**: –î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
4. **–ù–µ–¥–µ–ª—è 4**: –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∞—É–¥–∏—Ç

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –≤ —Ü–µ–ª–æ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **—Ö–æ—Ä–æ—à–∏–π —É—Ä–æ–≤–µ–Ω—å** –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ edge cases. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–≤—è–∑–∞–Ω—ã —Å:

1. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –Ω–∞ null/undefined –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö
2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º retry –ª–æ–≥–∏–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
3. –ù–µ–∫–æ—Ç–æ—Ä—ã–º–∏ race conditions –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ñ–∞–π–ª–∞–º–∏

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞.
